---
title: "Characterising Fish Movement Modes Project Overivew"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(mclust)
library(AdaptGauss)

set.seed(5)
```


### Data Overview

```{r}
data <- read_csv(here::here("01_data", "01_raw_data", "homerange_pld.csv")) %>%
  mutate(home_range = case_when(
    !is.na(observed_homerange) ~ observed_homerange,
    is.na(observed_homerange) ~ predicted_homerange
  )) %>%
  mutate(pld = case_when(
    !is.na(observed_pld) ~ observed_pld,
    is.na(observed_pld) ~ predicted_pld
  )) %>%
  filter(pld < 400) %>%
  mutate(magnitude_homerange = floor(log10(home_range))) %>%
  mutate(month_pld = ceiling(pld / 30))
```

This data was generated by a random forest regression model (https://towardsdatascience.com/random-forest-regression-5f605132d19d), meaning it is not empirical, but is predicted data. The next plot shows the actual values of the predictions.

```{r}
p1 <- ggplot(data, aes(log(home_range), pld)) +
  geom_point() +
  theme_bw() +
  labs(
    x = "log(Predicted Home Range)",
    y = "Predicted Pelagic Larval Duration"
  )

p1

ggsave(p1, file = paste0("data_fig.pdf"), path = here::here("04_figs"), height = 8, width = 15)
```

However, the models were validated based on accuracy at the order of magnitude level for home range and month for PLD. They were also relatively conservative underestimates. Therefore, I think we'll start by trying to cluster these values.

```{r}
ggplot(data, aes(magnitude_homerange, month_pld)) +
  geom_jitter() +
  theme_bw() +
  labs(
    x = "Predicted Home Range Magnitude",
    y = "Predicted Pelagic Larval Duration Month"
  )
```

##### Intial Clustering

Here, I using a Gaussian Mixture Model to cluster (https://towardsdatascience.com/gaussian-mixture-models-d13a5e915c8e). 

```{r}
gmm_data <- data %>%
  dplyr::select(magnitude_homerange, month_pld)
gmm_data2 <- data %>%
  dplyr::select(magnitude_homerange, month_pld, species)

gmm_mclust2 <- Mclust(gmm_data)
summary(gmm_mclust2)

gmm_mclust3 <- Mclust(gmm_data, G = 9)
summary(gmm_mclust3)

gmm_boot = mclustBootstrapLRT(gmm_data, modelName = "EEV", nboot = 9999, level = 0.05)
print(gmm_boot)

gmm_data2$class <- as.factor(gmm_mclust3[["classification"]])

p2 <- ggplot(gmm_data2, aes(magnitude_homerange, month_pld)) +
  geom_jitter(aes(color = class)) +
  theme_bw() +
  labs(
    x = "Order of Magnitude of Predicted Home Range",
    y = "Predicted Pelagic Larval Duration (Month)"
  )

p2
# ggsave(p2, file = paste0("gmm_fig.pdf"), path = here::here("04_figs"), height = 8, width = 15)

# write_csv(gmm_data2, here::here("01_data", "02_processed_data", "clusters.csv"))
```



My idea is for you to start with these clusters. You can get the cluster ID for each individual species from clusters.csv and then start pulling in variables to describe and, ideally, differentiate these clusters. Some of them are small so feel free to try combining some if that makes sense (I'm thinking maybe 2 and 6 especially). Also can consider breaking up bigger ones (like 1).

I think we will try starting with PCA to determine how different groupings are. https://towardsdatascience.com/principal-component-analysis-pca-explained-visually-with-zero-math-1cbf392b9e7d and https://towardsdatascience.com/a-one-stop-shop-for-principal-component-analysis-5582fb7e0a9c

# Week 1

### Tasks:

Prior to Meeting 2:

1. Create Github and link to R
2. Browse git and tidyverse tutorial
3. Read/Skim Papers and Prepare any questions you have, anything you need help understanding - focus on Lester et al.
4. Try to familiarize yourself some with what is in the FishBase tables

Meeting 2:

1. Show github organization
2. Discuss Papers
3. Strategize for characterization work
4. Discuss Week 2 goals

This will get less structured as we go. If you need more to do let me know and if you get stuck at any point, I'm pretty free for last minute meetings, working sessions, etc. My calendar is always up to date.
