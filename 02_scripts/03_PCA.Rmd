---
title: "PCA"
output: html_document
date: "2023-04-13"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(rfishbase)
library(FactoMineR)
library(factoextra)
library(car)
library(vegan)
library(patchwork)
library(cowplot)
library(ggpubr)
library(naniar)
library(pairwiseAdonis)
```

### Load data

```{r}
filled_data2 <- read_csv(here::here("01_data", "02_processed_data", "filled_data2.csv")) %>%
  mutate_if(is.character, as.factor)
```


### FAMD

```{r}

famd_1 <- filled_data2 %>%
  dplyr::select(
    temp_preferred, fecundity_mean, longevity_wild, sp_richness, length,
    r_fin, diet_troph3, oxygen_cons, temp_range, body_shape_i,
    dev_place, iucn_category, food_mode, demers_pelag,
    class2
  ) %>%
  mutate(class2 = as.factor(class2)) %>%
  na.omit()


f1 <- FAMD(famd_1[, 1:14], graph = FALSE)
f1

eigen_f1 <- f1$eig
eigen_f1

# Contribution to the first dimension
c1 <- fviz_contrib(f1, "var", axes = 1) + scale_y_continuous(breaks = seq(0,25,by = 0.5))
# Contribution to the second dimension  
c2 <- fviz_contrib(f1, "var", axes = 2) + scale_y_continuous(breaks = seq(0,26,by = 0.5))
c1 + c2

f1_var = as.data.frame(f1$var) 

rownames(f1_var) <- c("Optimal Temperature", "Mean Fecundity", "Lifespan", "Species Richness", "Length", 
                      "Growth Rate", "Trophic Level", "Oxygen Consumption", "Temperature Range",
                      "Body Shape", "Place of Development", "IUCN Category", "Feeding Mode", "Habitat Type")

f1_var <- f1_var %>% 
  dplyr::select(coord.Dim.1, coord.Dim.2) %>% 
  rownames_to_column(var = "var") %>% 
  mutate(coord.Dim.1 = case_when(
    var == "Optimal Temperature" ~ -coord.Dim.1,
    var == "Oxygen Consumption" ~ -coord.Dim.1,
    var == "Growth Rate" ~ -coord.Dim.1,
    TRUE ~ coord.Dim.1
  )) %>% 
  mutate(coord.Dim.2 = case_when(
    var == "Temperature Range" ~ -coord.Dim.2,
    TRUE ~ coord.Dim.2
  ))


# PLOTS ARROWS
plot1 <- fviz_famd_var(f1, "quanti.var",
  repel = TRUE,
  col.var = "black"
) +
  theme_bw(base_size = 16) +
  labs(x = "Dimmension 1", y = "Dimmension 2", title = NULL) +
  scale_y_continuous(position = "right")


f1_fig <- fviz_famd_ind(f1, label = "none", habillage = famd_1$class2, palette = hcl.colors(6, "viridis"), addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var", alpha.ind = 0.3, ellipse.alpha = 0.2) +
  theme_bw(base_size = 16) +
  labs(x = "FAMD1 (10.5%)", y = "FAMD2 (9%)", color = "Cohort (Homerange/PLD)", fill = "Cohort (Homerange/PLD)", title = NULL) +
  scale_y_continuous(position = "right") +
  theme(legend.position = "left") + 
  geom_segment(data = f1_var, aes(x = 0, xend = coord.Dim.1*7, y = 0, yend = coord.Dim.2*7), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.5) +
  ggrepel::geom_label_repel(data = f1_var, aes(x = coord.Dim.1*7, y = coord.Dim.2*7, label = var), cex = 3, direction = "both", segment.size = 0.25) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey") + 
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey")

f1_fig

#ggsave(f1_fig, file = paste0("famd_all_variables.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 12)
```


##### NMDS: All significant traits

```{r}

com_data4 <- filled_data2 %>%
  dplyr::select(
    temp_preferred, longevity_wild, sp_richness, length, r_fin, diet_troph3, temp_range, oxygen_cons,
    species, order, class2, class3
  ) %>%
  filter(temp_preferred > 0) %>%
  na.omit()

com4 <- com_data4 %>%
  dplyr::select(-species, -order, -class2, -class3)

m_com4 <- as.matrix(com4)

set.seed(123)
nmds <- metaMDS(m_com4, distance = "euclidean")
nmds

# extract NMDS scores (x and y coordinates)
filled_scores4 <- as.data.frame(scores(nmds)$sites)

# add columns to data frame
filled_scores4$class2 <- com_data4$class2
filled_scores4$species <- com_data4$species
filled_scores4$order <- com_data4$order

filled_scores4 <- filled_scores4 %>%
  mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))

species_scores4 <- as.data.frame(nmds[["species"]])

rownames(species_scores4) <- c("Optimal Temperature", "Lifespan", "Species Richness", "Length", 
                               "Growth Rate", "Trophic Level", "Temperature Range", "Oxygen Consumption")

species_scores4 <- species_scores4 %>% 
  rownames_to_column(var = "var")

centroid4 <- filled_scores4 %>%
  group_by(class2) %>%
  summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))

nmds4 <- ggplot(filled_scores4, aes(x = NMDS1, y = NMDS2)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), linewidth = 0.25, alpha = 0.2, show.legend = FALSE) +
  geom_point(aes(color = class2), alpha = 0.3) +
  theme_bw(base_size = 16) +
  geom_point(data = centroid4, aes(color = class2), size = 4, alpha = 0.9) +
  labs(x = "nMDS1", y = "nMDS2", color = "Class (Homerange/PLD)") +
  scale_color_viridis_d() +
  scale_fill_viridis_d() +
  geom_segment(data = species_scores4, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), linewidth = 0.5, colour = "grey20") +
  ggrepel::geom_label_repel(data = species_scores4, aes(x = MDS1, y = MDS2, label = var), fill = "white", cex = 3, direction = "both", segment.size = .25) +
  scale_y_continuous(position = "right") +
  theme(legend.position = "left", panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  annotate("text", x = 0.17, y = 0.25, label = "Stress: 0.155")

nmds4

#ggsave(nmds4, file = paste0("nmds_significant_traits.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 12)


dst4 <- dist(com4, method = "euclidean")

bd4 <- betadisper(dst4, com_data4$class2)

anova(bd4)

permutest(bd4, pairwise = TRUE, permutations = 9999)

adonis2(com_data4$class3 ~ m_com4, permutations = 9999)

pairwise.adonis(m_com4, com_data4$class3, perm = 9999)

```


##### NMDS 4 key traits: Optimal temperature, length, longevity, trophic level

```{r}

com_data7 <- filled_data2 %>%
  dplyr::select(
    temp_preferred, length, longevity_wild, diet_troph3,
    species, order, class2, class3
  ) %>%
  mutate(temp_preferred = temp_preferred + 2) %>%
  na.omit()

com7 <- com_data7 %>%
  dplyr::select(-species, -order, -class2, -class3)

m_com7 <- as.matrix(com7)

set.seed(123)
nmds <- metaMDS(m_com7, distance = "euclidean")
nmds

# extract NMDS scores (x and y coordinates)
filled_scores7 <- as.data.frame(scores(nmds)$sites)

# add columns to data frame
filled_scores7$class2 <- com_data7$class2
filled_scores7$species <- com_data7$species
filled_scores7$order <- com_data7$order

filled_scores7 <- filled_scores7 %>%
  mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))

species_scores7 <- as.data.frame(nmds[["species"]])

rownames(species_scores7) <- c("Optimal Temperature", "Length", "Lifespan", "Trophic Level")

species_scores7 <- species_scores7 %>% 
  rownames_to_column(var = "var")

centroid7 <- filled_scores7 %>%
  group_by(class2) %>%
  summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))

nmds7 <- ggplot(filled_scores7, aes(x = NMDS1, y = NMDS2)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), linewidth = 0.25, alpha = 0.2, show.legend = FALSE) +
  geom_point(aes(color = class2), alpha = 0.3) +
  theme_bw(base_size = 22) +
  geom_point(data = centroid7, aes(color = class2), size = 4, alpha = 0.9) +
  labs(x = "nMDS1", y = "nMDS2", color = "Class (home range/PLD)") +
  scale_color_viridis_d() +
  scale_fill_viridis_d() +
  geom_segment(data = species_scores7, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), linewidth = 0.5, colour = "grey20") +
  ggrepel::geom_label_repel(data = species_scores7, aes(x = MDS1, y = MDS2, label = var), size = 5, fill = "white", cex = 3, direction = "both", segment.size = .25) +
  scale_y_continuous(position = "right") +
  theme(legend.position = "left", panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  annotate("text", x = 0.15, y = 0.2, label = "Stress: 0.117")

nmds7

#ggsave(nmds7, file = paste0("nmds_4_traits.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 12)


dst7 <- dist(com7, method = "euclidean")

bd7 <- betadisper(dst7, com_data7$class2)

anova(bd7)

permutest(bd7, pairwise = TRUE, permutations = 9999)

adonis2(com_data7$class3 ~ m_com7, permutations = 9999)

pairwise.adonis(m_com7, com_data7$class3, perm = 9999)

```









# Old

```{r}

# com_data <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, fecundity_mean, longevity_wild,
#     sp_richness, length, r_fin, diet_troph3, oxygen_cons, 
#     temp_range, species, order, class2
#   ) %>%
#   filter(temp_preferred > 0) %>%
#   na.omit()
# 
# com <- com_data %>%
#   dplyr::select(-species, -order, -class2)
# 
# m_com <- as.matrix(com) 
# 
# set.seed(123)
# nmds <- metaMDS(m_com, distance = "euclidean")
# nmds
# 
# # extract NMDS scores (x and y coordinates)
# filled_scores <- as.data.frame(scores(nmds)$sites)
# 
# # add columns to data frame
# filled_scores$class2 <- com_data$class2
# filled_scores$species <- com_data$species
# filled_scores$order <- com_data$order
# 
# filled_scores <- filled_scores %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
# 
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
# 
# centroid <- filled_scores %>% 
#   group_by(class2) %>% 
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
# 
# nmds_plot1 <- ggplot(filled_scores, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2), alpha = 0) +
#   theme_bw(base_size = 16) +
#   geom_point(data = centroid, aes(color = class2), size = 4) +
#   labs(x = "nMDS1", y = "nMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), linewidth = 1, alpha = 0.2, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d() +
#   scale_y_continuous(position = "right") +
#   theme(legend.position = "left")
# 
# nmds_plot1
# 
# nmds_arrows1 <- ggplot(filled_scores, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw(base_size = 16) +
#   labs(x = "nMDS1", y = "nMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") + 
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey") +
#   scale_y_continuous(position = "right")
# 
# nmds_arrows1
# 
# nmds1 <- (nmds_plot1 | nmds_arrows1) +
#   plot_annotation(tag_levels = 'A')
# 
# nmds1
# 
# #ggsave(nmds1, file = paste0("nmds1.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 18)
# 
# 
# dst <- dist(com, method = "euclidean")
# 
# bd <- betadisper(dst, com_data$class2)
# 
# anova(bd)
# 
# permutest(bd, pairwise = TRUE, permutations = 9999)
```



```{r}
# famd_4 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, longevity_wild, sp_richness, length,  r_fin, diet_troph3, temp_range, oxygen_cons, demers_pelag, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
# 
# f4 <- FAMD(famd_4[, 1:10], graph = FALSE)
# f4
# 
# eigen_f4 <- f4$eig
# eigen_f4
# 
# # Contribution to the first dimension
# fviz_contrib(f4, "var", axes = 1) + fviz_contrib(f4, "var", axes = 2)
# # Contribution to the second dimension
# 
# 
# # PLOTS ARROWS
# p4 <- fviz_famd_var(f4, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# ) +
#   theme_bw(base_size = 16) +
#   labs(x = "Dimmension 1", y = "Dimmension 2", title = NULL) +
#   scale_y_continuous(position = "right")
# 
# 
# f4_fig <- fviz_famd_ind(f4, label = "none", habillage = famd_4$class2, palette = hcl.colors(6, "viridis"), addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw(base_size = 16) +
#   labs(x = "FAMD1 (16.4%)", y = "FAMD2 (13.6%)", color = "Class (Homerange/PLD)", fill = "Class (Homerange/PLD)", title = NULL) +
#   scale_y_continuous(position = "right") +
#   theme(legend.position = "left")
# 
# f4_fig
# 
# plot4 <- (f4_fig | p4) +
#   plot_annotation(tag_levels = "A")
# 
# plot4
# 
# # ggsave(plot4, file = paste0("f4.pdf"), path = here::here("04_figs", "famd_with_arrows"), height = 8, width = 18)
# ```
# 
# 
# ```{r}
# famd_5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, longevity_wild, sp_richness, r_fin, temp_range, demers_pelag, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
# 
# f5 <- FAMD(famd_5[, 1:6], graph = FALSE)
# f5
# 
# eigen_f5 <- f5$eig
# eigen_f5
# 
# # Contribution to the first dimension
# fviz_contrib(f5, "var", axes = 1) + fviz_contrib(f5, "var", axes = 2)
# # Contribution to the second dimension
# 
# 
# # PLOTS ARROWS
# p5 <- fviz_famd_var(f5, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# ) +
#   theme_bw(base_size = 16) +
#   labs(x = "Dimmension 1", y = "Dimmension 2", title = NULL) +
#   scale_y_continuous(position = "right")
# 
# 
# f5_fig <- fviz_famd_ind(f5, label = "none", habillage = famd_5$class2, palette = hcl.colors(6, "viridis"), addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw(base_size = 16) +
#   labs(x = "FAMD1 (18.9%)", y = "FAMD2 (16.1%)", color = "Class (Homerange/PLD)", fill = "Class (Homerange/PLD)", title = NULL) +
#   scale_y_continuous(position = "right") +
#   theme(legend.position = "left")
# 
# f5_fig
# 
# plot5 <- (f5_fig | p5) +
#   plot_annotation(tag_levels = "A")
# 
# plot5
# 
# # ggsave(plot5, file = paste0("f5.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 16)
# ```
# 
# 
# ```{r}
# famd_8 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, longevity_wild, diet_troph3, demers_pelag, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
# 
# f8 <- FAMD(famd_8[, 1:5], graph = FALSE)
# f8
# 
# eigen_f8 <- f8$eig
# eigen_f8
# 
# # Contribution to the first dimension
# fviz_contrib(f8, "var", axes = 1) + fviz_contrib(f8, "var", axes = 2)
# # Contribution to the second dimension
# 
# 
# # PLOTS ARROWS
# p8 <- fviz_famd_var(f8, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# ) +
#   theme_bw(base_size = 16) +
#   labs(x = "Dimmension 1", y = "Dimmension 2", title = NULL) +
#   scale_y_continuous(position = "right")
# 
# 
# f8_fig <- fviz_famd_ind(f8, label = "none", habillage = famd_8$class2, palette = hcl.colors(6, "viridis"), addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw(base_size = 16) +
#   labs(x = "FAMD1 (17.4%)", y = "FAMD2 (16%)", color = "Class (Homerange/PLD)", fill = "Class (Homerange/PLD)", title = NULL) +
#   scale_y_continuous(position = "right") +
#   theme(legend.position = "left")
# 
# f8_fig
# 
# plot8 <- (f8_fig | p8) +
#   plot_annotation(tag_levels = "A")
# 
# plot8
# 
# # ggsave(plot8, file = paste0("f8.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 18)
```








### Plot panel

```{r}
# cat_first_col <- (demers_plot / body_plot / climate_plot) &
#   theme(legend.position = "none")
#
# cat_second_col <- (movement_plot / dev_plot / food_plot) &
#   theme(legend.position = "none") &
#   theme(axis.text.y = element_blank(), axis.title.y = element_blank())
#
# cat_top <- (cat_first_col | cat_second_col)
#
# cat_bottom <- (iucn_plot | plot_spacer()) + plot_layout(widths = c(55,30))
#
# cat_panel <- (cat_top / cat_bottom) + plot_layout(heights = c(85,20))
#
# cat_panel
#
# ggsave(cat_panel, file = paste0("cat_panel.png"), path = here::here("04_figs", "individual_plots", "categorical"), height = 14, width = 10)
```


### FAMD

```{r}
# famd_2 <- filled_data2 %>%
#   dplyr::select(
#     demers_pelag, temp_range, r_fin, longevity_wild, length, temp_preferred, iucn_category, sp_richness, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
#
# f2 <- FAMD(famd_2[, 1:8], graph = FALSE)
# f2
#
# eigen_f2 <- f2$eig
# eigen_f2
#
# # Contribution to the first dimension
# fviz_contrib(f2, "var", axes = 1) + fviz_contrib(f2, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p2 <- fviz_famd_var(f2, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# )
#
#
#
# f2_fig <- fviz_famd_ind(f2, label = "none", habillage = famd_2$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f2_fig
#
# plot2 <- p2 + f2_fig
#
# plot2
#
# #ggsave(plot2, file = paste0("f2.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_3 <- filled_data2 %>%
#   dplyr::select(
#     longevity_wild, r_fin, temp_range, demers_pelag, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
#
# f3 <- FAMD(famd_3[, 1:4], graph = FALSE)
# f3
#
# eigen_f3 <- f3$eig
# eigen_f3
#
# # Contribution to the first dimension
# fviz_contrib(f3, "var", axes = 1) + fviz_contrib(f3, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p3 <- fviz_famd_var(f3, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# )
#
#
# f3_fig <- fviz_famd_ind(f3, label = "none", habillage = famd_3$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f3_fig
#
# plot3 <- p3 + f3_fig
#
# plot3
#
# #ggsave(plot3, file = paste0("f3.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_6 <- filled_data2 %>%
#   dplyr::select(
#   temp_preferred, length, longevity_wild, diet_troph3,  demers_pelag, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f6 <- FAMD(famd_6[,1:6], graph = FALSE)
# f6
#
# eigen_f6 <- f6$eig
# eigen_f6
#
# # Contribution to the first dimension
# fviz_contrib(f6, "var", axes = 1) + fviz_contrib(f6, "var", axes = 2)
# # Contribution to the second dimension
#
#
# # PLOTS ARROWS
# p6 <- fviz_famd_var(f6, "quanti.var",
#   repel = TRUE,
#   col.var = "black"
# ) +
#   theme_bw(base_size = 16) +
#   labs(x = "Dimmension 1", y = "Dimmension 2", title = NULL)
#
#
# f6_fig <- fviz_famd_ind(f6, label = "none", habillage = famd_6$class2, palette = hcl.colors(6, "viridis"), addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw(base_size = 16) +
#   labs(x = "FAMD1 (15.8%)", y = "FAMD2 (14.5%)", color = "Class (Homerange/PLD)", fill = "Class (Homerange/PLD)", title = NULL)
#
# f6_fig
#
# plot6 <- (p6 | f6_fig) +
#   plot_annotation(tag_levels = 'A')
#
# plot6
#
# #ggsave(plot6, file = paste0("f6.pdf"), path = here::here("04_figs", "famd_with_arrows"), height = 8, width = 18)
```

```{r}
# famd_7 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, demers_pelag, oxygen_cons, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f7 <- FAMD(famd_7[,1:4], graph = FALSE)
# f7
#
# eigen_f7 <- f7$eig
# eigen_f7
#
# # Contribution to the first dimension
# fviz_contrib(f7, "var", axes = 1) + fviz_contrib(f7, "var", axes = 2)
# # Contribution to the second dimension
#
# # PLOTS ARROWS
# p7<- fviz_famd_var(f7, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f7_fig <- fviz_famd_ind(f7, label = "none", habillage = famd_7$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f7_fig
#
# plot7 <- p7 + f7_fig
#
# plot7
#
# #ggsave(plot7, file = paste0("f7.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_9 <- filled_data2 %>%
#   dplyr::select(
#     demers_pelag, temp_range, r_fin, longevity_wild, length, sp_richness, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f9 <- FAMD(famd_9[,1:6], graph = FALSE)
# f9
#
# eigen_f9 <- f9$eig
# eigen_f9
#
# # Contribution to the first dimension
# fviz_contrib(f9, "var", axes = 1) + fviz_contrib(f9, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p9<- fviz_famd_var(f9, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f9_fig <- fviz_famd_ind(f9, label = "none", habillage = famd_9$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f9_fig
#
# plot9 <- p9 + f9_fig
#
# plot9
#
# #ggsave(plot9, file = paste0("f9.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_10 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, demers_pelag, diet_troph3, longevity_wild, sp_richness, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f10 <- FAMD(famd_10[,1:6], graph = FALSE)
# f10
#
# eigen_f10 <- f10$eig
# eigen_f10
#
# # Contribution to the first dimension
# fviz_contrib(f10, "var", axes = 1) + fviz_contrib(f10, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p10<- fviz_famd_var(f10, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f10_fig <- fviz_famd_ind(f10, label = "none", habillage = famd_10$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f10_fig
#
# plot10 <- p10 + f10_fig
#
# plot10
#
# #ggsave(plot10, file = paste0("f10.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_11 <- filled_data2 %>%
#   dplyr::select(
#     demers_pelag, temp_range, r_fin, longevity_wild, sp_richness, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f11 <- FAMD(famd_11[,1:5], graph = FALSE)
# f11
#
# eigen_f11 <- f11$eig
# eigen_f11
#
# # Contribution to the first dimension
# fviz_contrib(f11, "var", axes = 1) + fviz_contrib(f11, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p11<- fviz_famd_var(f11, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f11_fig <- fviz_famd_ind(f11, label = "none", habillage = famd_11$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f11_fig
#
# plot11 <- p11 + f11_fig
#
# plot11
#
# #ggsave(plot11, file = paste0("f11.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_12 <- filled_data2 %>%
#   dplyr::select(
#     length, demers_pelag, longevity_wild, r_fin, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f12 <- FAMD(famd_12[,1:4], graph = FALSE)
# f12
#
# eigen_f12 <- f12$eig
# eigen_f12
#
# # Contribution to the first dimension
# fviz_contrib(f12, "var", axes = 1) + fviz_contrib(f12, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p12<- fviz_famd_var(f12, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f12_fig <- fviz_famd_ind(f12, label = "none", habillage = famd_12$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f12_fig
#
# plot12 <- p12 + f12_fig
#
# plot12
#
# #ggsave(plot12, file = paste0("f12.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```

```{r}
# famd_13 <- filled_data2 %>%
#   dplyr::select(
#     demers_pelag, longevity_wild, temp_range, temp_preferred, class2
#   ) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# f13 <- FAMD(famd_13[,1:4], graph = FALSE)
# f13
#
# eigen_f13 <- f13$eig
# eigen_f13
#
# # Contribution to the first dimension
# fviz_contrib(f13, "var", axes = 1) + fviz_contrib(f13, "var", axes = 2)
# # Contribution to the second dimension
#
#
#
# # PLOTS ARROWS
# p13<- fviz_famd_var(f13, "quanti.var",
#   repel = TRUE,
#   col.var = "black")
#
#
# f13_fig <- fviz_famd_ind(f13, label = "none", habillage = famd_13$class2, addEllipses = TRUE, ellipse.level = 0.95, invisible = "quali.var") +
#   theme_bw()
#
# f13_fig
#
# plot13 <- p13 + f13_fig
#
# plot13
#
# #ggsave(plot13, file = paste0("f13.png"), path = here::here("04_figs", "famd_with_arrows"), height = 12, width = 15)
```





##### NMDS 2

```{r}
# com_data2 <- filled_data2 %>%
#   dplyr::select(
#     longevity_wild,
#     sp_richness, r_fin, oxygen_cons,
#     temp_range, species, order, class2
#   ) %>%
#   na.omit()
# 
# com2 <- com_data2 %>%
#   dplyr::select(-species, -order, -class2)
# 
# m_com2 <- as.matrix(com2)
# 
# set.seed(123)
# nmds <- metaMDS(m_com2, distance = "euclidean")
# nmds
# 
# # extract NMDS scores (x and y coordinates)
# filled_scores2 <- as.data.frame(scores(nmds)$sites)
# 
# # add columns to data frame
# filled_scores2$class2 <- com_data2$class2
# filled_scores2$species <- com_data2$species
# filled_scores2$order <- com_data2$order
# 
# filled_scores2 <- filled_scores2 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
# 
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
# 
# centroid2 <- filled_scores2 %>%
#   group_by(class2) %>%
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
# 
# nmds_plot2 <- ggplot(filled_scores2, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw(base_size = 16) +
#   geom_point(data = centroid2, aes(color = class2), size = 4) +
#   labs(x = "NMDS1", y = "NMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), alpha = 0.15, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d() +
#   scale_y_continuous(position = "right") +
#   theme(legend.position = "left")
# 
# nmds_plot2
# 
# nmds_arrows2 <- ggplot(filled_scores2, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw(base_size = 16) +
#   labs(x = "NMDS1", y = "NMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey") +
#   scale_y_continuous(position = "right")
# 
# nmds_arrows2
# 
# nmds2 <- (nmds_plot2 + nmds_arrows2) +
#   plot_annotation(tag_levels = "A")
# 
# nmds2
# 
# # ggsave(nmds2, file = paste0("nmds2.pdf"), path = here::here("04_figs", "final_figs"), height = 8, width = 18)
# 
# 
# dst2 <- dist(com2, method = "euclidean")
# 
# bd2 <- betadisper(dst2, com_data2$class2)
# 
# anova(bd2)
# 
# permutest(bd2, pairwise = TRUE, permutations = 9999)
```

##### NMDS Plot 3

```{r}
# com_data3 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, longevity_wild, diet_troph3, 
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
# 
# com3 <- com_data3 %>%
#   dplyr::select(-species, -order, -class2)
# 
# m_com3 <- as.matrix(com3)
# 
# set.seed(123)
# nmds <- metaMDS(m_com3, distance = "euclidean")
# nmds
# 
# # extract NMDS scores (x and y coordinates)
# filled_scores3 <- as.data.frame(scores(nmds)$sites)
# 
# # add columns to data frame
# filled_scores3$class2 <- com_data3$class2
# filled_scores3$species <- com_data3$species
# filled_scores3$order <- com_data3$order
# 
# filled_scores3 <- filled_scores3 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
# 
# 
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
# 
# centroid3 <- filled_scores3 %>%
#   group_by(class2) %>%
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
# 
# nmds_plot3 <- ggplot(filled_scores3, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   geom_point(data = centroid3, aes(color = class2), size = 4) +
#   labs(x = "NMDS1", y = "NMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), alpha = 0.15, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d()
# 
# nmds_plot3
# 
# nmds_arrows3 <- ggplot(filled_scores3, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw() +
#   labs(x = "NMDS1", y = "NMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey")
# 
# nmds_arrows3
# 
# nmds3 <- nmds_arrows3 + nmds_plot3 & theme_bw(base_size = 16)
# 
# nmds3
# 
# #ggsave(nmds3, file = paste0("nmds3.png"), path = here::here("04_figs", "nmds"), height = 8, width = 18)
# 
# dst3 <- dist(com3, method = "euclidean")
# 
# bd3 <- betadisper(dst3, com_data3$class2)
# 
# anova(bd3)
# 
# permutest(bd3, pairwise = TRUE, permutations = 9999)
# 
# ```
# 
# ##### NMDS 5
# 
# ```{r}
# 
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     longevity_wild, sp_richness, length,  r_fin, oxygen_cons,
#     species, order, class2
#   ) %>%
#   na.omit()
# 
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
# 
# m_com5 <- as.matrix(com5)
# 
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
# 
# 
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
# 
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
# 
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
# 
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
# 
# centroid5 <- filled_scores5 %>%
#   group_by(class2) %>%
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
# 
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   geom_point(data = centroid5, aes(color = class2), size = 4) +
#   labs(x = "NMDS1", y = "NMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), alpha = 0.15, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d()
# 
# nmds_plot5
# 
# nmds_arrows5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw() +
#   labs(x = "NMDS1", y = "NMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey")
# 
# nmds_arrows5
# 
# nmds5 <- nmds_arrows5 + nmds_plot5 & theme_bw(base_size = 16)
# 
# nmds5
# 
# #ggsave(nmds5, file = paste0("nmds5.png"), path = here::here("04_figs", "nmds"), height = 8, width = 18)
# 
# dst5 <- dist(com5, method = "euclidean")
# 
# bd5 <- betadisper(dst5, com_data5$class2)
# 
# anova(bd5)
# 
# permutest(bd5, pairwise = TRUE, permutations = 9999)

```

##### NMDS Plot 6

```{r}
# com_data6 <- filled_data2 %>%
#   dplyr::select(
#     longevity_wild,  oxygen_cons,
#     species, order, class2
#   ) %>%
#   na.omit()
# 
# com6 <- com_data6 %>%
#   dplyr::select(-species, -order, -class2)
# 
# m_com6 <- as.matrix(com6)
# 
# set.seed(123)
# nmds <- metaMDS(m_com6, distance = "euclidean")
# nmds
# 
# 
# # extract NMDS scores (x and y coordinates)
# filled_scores6 <- as.data.frame(scores(nmds)$sites)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
# 
# # add columns to data frame
# filled_scores6$class2 <- com_data6$class2
# filled_scores6$species <- com_data6$species
# filled_scores6$order <- com_data6$order
# 
# filled_scores6 <- filled_scores6 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
# 
# 
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
# 
# centroid6 <- filled_scores6 %>%
#   group_by(class2) %>%
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
# 
# nmds_plot6 <- ggplot(filled_scores6, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   geom_point(data = centroid6, aes(color = class2), size = 4) +
#   labs(x = "NMDS1", y = "NMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), alpha = 0.15, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d()
# 
# nmds_plot6
# 
# nmds_arrows6 <- ggplot(filled_scores6, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw() +
#   labs(x = "NMDS1", y = "NMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey")
# 
# nmds_arrows6
# 
# nmds6 <- nmds_arrows6 + nmds_plot6 & theme_bw(base_size = 16)
# 
# nmds6
# 
# #ggsave(nmds6, file = paste0("nmds6.png"), path = here::here("04_figs", "nmds"), height = 8, width = 18)
# 
# dst6 <- dist(com6, method = "euclidean")
# 
# bd6 <- betadisper(dst6, com_data6$class2)
# 
# anova(bd6)
# 
# permutest(bd6, pairwise = TRUE, permutations = 9999)

```

##### NMDS Plot 8

```{r}
# com_data8 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, diet_troph3,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com8 <- com_data8 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com8 <- as.matrix(com8)
#
# set.seed(123)
# nmds <- metaMDS(m_com8, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores8 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores8$class2 <- com_data8$class2
# filled_scores8$species <- com_data8$species
# filled_scores8$order <- com_data8$order
#
# filled_scores8 <- filled_scores8 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
# centroid8 <- filled_scores8 %>%
#   group_by(class2) %>%
#   summarize(NMDS1 = mean(NMDS1), NMDS2 = mean(NMDS2))
#
# nmds_plot8 <- ggplot(filled_scores8, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   geom_point(data = centroid8, aes(color = class2), size = 4) +
#   labs(x = "NMDS1", y = "NMDS2", color = "Class (Homerange/PLD)") +
#   theme(axis.title.y = element_blank(), axis.text.y = element_blank()) +
#   stat_ellipse(geom = "polygon", aes(color = class2, fill = class2), alpha = 0.15, show.legend = FALSE) +
#   scale_color_viridis_d() +
#   scale_fill_viridis_d()
#
# nmds_plot8
#
#
# nmds_arrows8 <- ggplot(filled_scores8, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(alpha = 0) +
#   theme_bw() +
#   labs(x = "NMDS1", y = "NMDS2") +
#   theme(legend.position = "none") +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25) +
#   geom_vline(xintercept = 0, linetype = "dashed", color = "grey") +
#   geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
#   geom_point(aes(x = 0, y = 0), size = 160, shape = 1, color = "grey")
#
# nmds_arrows8
#
# nmds8 <- nmds_arrows8 + nmds_plot8 & theme_bw(base_size = 16)
#
# nmds8
#
# ggsave(nmds8, file = paste0("nmds8.png"), path = here::here("04_figs", "nmds"), height = 8, width = 18)
#
# dst8 <- dist(com8, method = "euclidean")
#
# bd8 <- betadisper(dst8, com_data8$class2)
#
# anova(bd8)
#
# permutest(bd8, pairwise = TRUE, permutations = 9999)
```

##### NMDS Plot 9

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, r_fin, diet_troph3, temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_9.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 10

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, diet_troph3, temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_10.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 11

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, longevity_wild, diet_troph3, temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_11.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```


##### NMDS 12

```{r}
# com_data12 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com12 <- com_data12 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com12 <- as.matrix(com12)
#
# set.seed(123)
# nmds <- metaMDS(m_com12, distance = "euclidean")
# nmds
#
#
# # extract NMDS scores (x and y coordinates)
# filled_scores12 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores12$class2 <- com_data12$class2
# filled_scores12$species <- com_data12$species
# filled_scores12$order <- com_data12$order
#
# filled_scores12 <- filled_scores12 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot12 <- ggplot(filled_scores12, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot12
#
# #ggsave(nmds_plot12, file = paste0("nmds_12.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst12 <- dist(com12, method = "euclidean")
#
# bd12 <- betadisper(dst12, com_data12$class2)
#
# anova(bd12)
#
# permutest(bd12, pairwise = TRUE, permutations = 9999)
```


##### NMDS Plot 13

```{r}
# com_data13 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, sp_richness, temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com13 <- com_data13 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com13 <- as.matrix(com13)
#
# set.seed(123)
# nmds <- metaMDS(m_com13, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores13 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores13$class2 <- com_data13$class2
# filled_scores13$species <- com_data13$species
# filled_scores13$order <- com_data13$order
#
# filled_scores13 <- filled_scores13 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot13 <- ggplot(filled_scores13, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot13
#
# #ggsave(nmds_plot13, file = paste0("nmds_13.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst13 <- dist(com13, method = "euclidean")
#
# bd13 <- betadisper(dst13, com_data13$class2)
#
# anova(bd13)
#
# permutest(bd13, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 14

```{r}
# com_data14 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, sp_richness,  temp_range,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com14 <- com_data14 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com14 <- as.matrix(com14)
#
# set.seed(123)
# nmds <- metaMDS(m_com14, distance = "euclidean")
# nmds
#
#
# # extract NMDS scores (x and y coordinates)
# filled_scores14 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores14$class2 <- com_data14$class2
# filled_scores14$species <- com_data14$species
# filled_scores14$order <- com_data14$order
#
# filled_scores14 <- filled_scores14 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot14 <- ggplot(filled_scores14, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot14
#
# #ggsave(nmds_plot14, file = paste0("nmds_14.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst14 <- dist(com14, method = "euclidean")
#
# bd14 <- betadisper(dst14, com_data14$class2)
#
# anova(bd14)
#
# permutest(bd14, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 17

```{r}
# com_data17 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, oxygen_cons,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com17 <- com_data17 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com17 <- as.matrix(com17)
#
# set.seed(123)
# nmds <- metaMDS(m_com17, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores17 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores17$class2 <- com_data17$class2
# filled_scores17$species <- com_data17$species
# filled_scores17$order <- com_data17$order
#
# filled_scores17 <- filled_scores17 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot17 <- ggplot(filled_scores17, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot17
#
# #ggsave(nmds_plot17, file = paste0("nmds_17.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst17 <- dist(com17, method = "euclidean")
#
# bd17 <- betadisper(dst17, com_data17$class2)
#
# anova(bd17)
#
# permutest(bd17, pairwise = TRUE, permutations = 9999)
```


##### NMDS Plot 15

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, longevity_wild,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_15.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 16

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, length,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_16.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```


##### NMDS Plot 18

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, r_fin, diet_troph3, fecundity_mean,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_18.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```



##### NMDS Plot 19

```{r}
# com_data5 <- filled_data2 %>%
#   dplyr::select(
#     temp_preferred, length, diet_troph3, fecundity_mean,
#     species, order, class2
#   ) %>%
#   mutate(temp_preferred = temp_preferred + 2) %>%
#   na.omit()
#
# com5 <- com_data5 %>%
#   dplyr::select(-species, -order, -class2)
#
# m_com5 <- as.matrix(com5)
#
# set.seed(123)
# nmds <- metaMDS(m_com5, distance = "euclidean")
# nmds
#
# # extract NMDS scores (x and y coordinates)
# filled_scores5 <- as.data.frame(scores(nmds)$sites)
#
# # add columns to data frame
# filled_scores5$class2 <- com_data5$class2
# filled_scores5$species <- com_data5$species
# filled_scores5$order <- com_data5$order
#
# filled_scores5 <- filled_scores5 %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order), species = as.factor(species))
#
# species_scores <- as.data.frame(nmds[["species"]]) %>%
#   rownames_to_column(var = "var")
#
#
# nmds_plot5 <- ggplot(filled_scores5, aes(x = NMDS1, y = NMDS2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   # theme(legend.position = "none") +
#   labs(x = "NMDS1", y = "NMDS2") +
#   stat_ellipse(geom = "polygon", aes(fill = class2, color = class2), alpha = 0.2) +
#   geom_segment(data = species_scores, aes(x = 0, xend = MDS1, y = 0, yend = MDS2), arrow = arrow(length = unit(0.25, "cm")), colour = "grey10", lwd = 0.3) +
#   ggrepel::geom_text_repel(data = species_scores, aes(x = MDS1, y = MDS2, label = var), cex = 3, direction = "both", segment.size = 0.25)
#
# nmds_plot5
#
# #ggsave(nmds_plot5, file = paste0("nmds_19.png"), path = here::here("04_figs", "nmds"), height = 12, width = 12)
#
# dst5 <- dist(com5, method = "euclidean")
#
# bd5 <- betadisper(dst5, com_data5$class2)
#
# anova(bd5)
#
# permutest(bd5, pairwise = TRUE, permutations = 9999)
```


```{r}
# continuous

# plot1_data = fishbase_data

# #option1 sort by variable
# plot1_data = plot1_data %>%
#   dplyr::select(r_fin, species, class2) %>%
#   mutate(r_fin = sort(r_fin)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(species = fct_relevel(plot1_data$species))
#
# ggplot(plot1_data, aes(species, r_fin)) +
#   geom_point(aes(color = class2))


# sort by variable and color by class

# plot2_data = filled_data2 %>%
#   filter(temp_preferred != "NA")
#
# plot2_data = filled_data2
#
# plot2_data <- plot2_data %>%
#   #mutate(length = sort(length)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(order = as.factor(order)) %>%
#   mutate(species = fct_relevel(plot2_data$species))
#
# #more descriptive**** # USE THESE PLOTS for continuous
# ind3 <- ggplot(plot2_data, aes(r_fin, class2)) +
#   geom_boxplot(aes(color = class2)) +
#   theme_bw(base_size  = 20) +
#   labs(y = "Movement Class",
#        x = "Growth Rate", color = "Class (homerange/PLD)")
#   #theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
#   #theme(legend.position = "none")
# ind3
#
#
# ggsave(ind3, file = paste0("ind3.png"), path = here::here("04_figs", "individual_plots"))


# #more to find groupings
# ggplot(plot1_data, aes(species, r_fin)) +
#   geom_point(aes(color = class2))
```


```{r}
# plot2_data = filled_data2
#
# plot2_data <- plot2_data %>%
#   #mutate(length = sort(length)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(movement_keyword = as.factor(movement_keyword)) %>%
#   mutate(species = fct_relevel(plot2_data$species))
#
# #more descriptive**** # USE THESE PLOTS for continuous
# ind2 <- ggplot(plot2_data, aes(movement_keyword, class2)) +
#   geom_jitter(aes(color = class2)) +
#   theme_bw(base_size  = 20) +
#   labs(y = "Movement Class",
#        x = "Movement Keyword", color = "Class (homerange/PLD)") +
#   theme(axis.text.x = element_text(angle = 30, hjust=1, size = 8))
#   #theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
#   #theme(legend.position = "none")
# ind2
#
#
# ggsave(ind2, file = paste0("ind2.png"), path = here::here("04_figs", "individual_plots"))
```


```{r}
# categorical
# plot2_data = filled_data %>%
#   dplyr::select(demers_pelag, r_fin, species, class2, family, movement_keyword,
#          order, class_taxon, longevity_wild, diet_troph3) %>%
#   mutate(class2 = as.factor(class2), order = as.factor(order))
#
# # #to find groupings
# # ggplot(plot2_data, aes(class2, demers_pelag)) +
# #   geom_point(aes(color = family)) +
# #   theme(legend.position = "none")
#
# #more descriptive*** - USE THIS FOR CATEGORICAL
# ggplot(plot2_data, aes(class2, movement_keyword)) +
#   #geom_point(aes(color = demers_pelag)) +
#   geom_boxplot(aes(color = class2)) +
#   theme_bw() +
#   labs(x = "Movement Keyword",
#        y = "Movement Class") +
#   #theme(legend.position = "none") +
#   scale_color_viridis_d() +
#   theme(axis.text.x = element_text(angle = 30, hjust=1))
#   #scale_color_manual(values = c("", ""))
```


### Metabolic data

```{r}
# plot2_data = fishbase_data
# plot2_data <- plot2_data[!is.na(plot2_data$oxygen_cons),]
#
# ggplot(plot2_data, aes(oxygen_cons, class2)) +
#   geom_point(aes(color = class2))
#
# #option1 sort by oxygen_cons
# plot2_data = plot2_data %>%
#   dplyr::select(oxygen_cons, species, class2, genus, order, temp_preferred) %>%
#   mutate(oxygen_cons = sort(oxygen_cons)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(species = fct_relevel(plot2_data$species))
#
# ggplot(plot2_data, aes(oxygen_cons, class2)) +
#   geom_jitter(aes(color = oxygen_cons)) +
#   theme_bw() +
#   theme(legend.position="none") +
#   theme(axis.text.x=element_blank()) +
#   labs(x = "Species",
#        y = "O2 Consumption Rate") # +
#   #scale_color_viridis_d()
#
# # no noteworthy groupings for class - try coloring by family/order
#
#
# #option 2 sort by class
# plot2_data = plot2_data %>%
#   dplyr::select(oxygen_cons, species, class2, order, temp_preferred)%>%
#   mutate(class2 = sort(class2)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(species = fct_relevel(plot2_data$species))
#
# #more descriptive****
# ggplot(plot2_data, aes(temp_preferred, class2)) +
#   geom_point(aes(color = class2)) +
#   theme_bw() +
#   labs(x = "Optimal Temp",
#        y = "Movement Class") +
#   theme(legend.position = "none")
#
```




```{r}
#
# plot3_data = fishbase_data %>%
#   dplyr::select(demers_pelag, env_temp, body_shape_i, species, class, class2) %>%
#   mutate(class = as.factor(class), class2 = as.factor(class2))
#
# #to find groupings
# ggplot(plot3_data, aes(species, env_temp)) +
#   geom_point(aes(color = class2))
#
# #more descriptive
# ggplot(plot3_data, aes(body_shape_i, class2)) +
#   geom_jitter(aes(color = body_shape_i)) +
#   theme_bw() +
#   labs(x = "env_temp",
#        y = "Movement Class",
#        color = "Habitat Type") +
#   scale_color_viridis_d() +
#   theme(axis.text.x = element_text(angle = 30, hjust=1))
#   #scale_color_manual(values = c("", ""))
#
# plot4_data = fishbase_data %>%
#   dplyr::select(length, species, class2) %>%
#   #mutate(class2 = sort(length)) %>% this line is causing problemssssss
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(species = fct_relevel(plot4_data$species))
#
# ggplot(plot4_data, aes(species, length)) +
#   geom_jitter(aes(color = class2))
#
```


### DO NMDS HERE INSTEAD OF PCA WITH EUCLIDEAN DISTANCE FROM NOW ON 


Most of this can probably go in old now and then doing overall NMDS and FAMD then subset ones

### PCA with new variables added

```{r}
# fishbase_p1 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select(r_fin, longevity_wild, length, fecundity_mean, diet_troph3, class2) %>%
#   na.omit() # YOU WANT TO REMOVE COLUMNS WITH NAS FOR PCA, AND PROBABLY NMDS TOO
#
# p1 <- PCA(fishbase_p1[,1:5], graph = FALSE) # runs the PCA on the first 5 columns (not class)
# p1
#
# eigen_p1 <- p1$eig
# eigen_p1 # 69.07% variance explained by first 2 components
#
# p1_fig <- fviz_pca_ind(p1, label = "none", habillage = fishbase_p1$class2, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# p1_fig
#
# ggsave(p1_fig, file = paste0("p1_fig.png"), path = here::here("04_figs", "current_pca_famd"))
#
#
# # Vizualize variable contributions to components
#
# fviz_pca_biplot(p1, repel = TRUE, label = "none", habillage = fishbase_p1$class2)
#
#
# # Contributions of variables to PC1
# p1_c1 <- fviz_contrib(p1, choice = "var", axes = 1, top = 10)
#
# # Contributions of variables to PC2
# p1_c2 <- fviz_contrib(p1, choice = "var", axes = 2, top = 10)
#
# components_p1 <- gridExtra::grid.arrange(p1_c1, p1_c2, ncol = 2)
#
#
# #ggsave(components_p1, file = paste0("components_p1.png"), path = here::here("04_figs", "current_pca_famd"))
```



```{r}
# fishbase_p2 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select(r_fin, length, diet_troph3, class2) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   na.omit()
#
# p2 <- PCA(fishbase_p2[,1:3], graph = FALSE) # runs the PCA on the first 4 columns (not class)
# p2
#
# eigen_p2 <- p2$eig
# eigen_p2 # 74.71% of variance explained by first 2 components
#
# p2_fig <- fviz_pca_ind(p2, label = "none", habillage = fishbase_p2$class2, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# p2_fig

# ggsave(p2_fig, file = paste0("p2_fig.png"), path = here::here("04_figs"))
```



### FAMD with new variables added

```{r}
# fishbase_f1 <- fishbase_data %>%
#    dplyr::select(weight, env_temp, temp_preferred, fecundity_mean, r_fin, class2) %>%
#    mutate(class2 = as.factor(class2),
#           env_temp = as.factor(env_temp)) %>%
#    na.omit()
#
# f1 <- FAMD(fishbase_f1[,1:5], graph=FALSE)
# f1
#
# eigen_f1 <- f1$eig
# eigen_f1 # 42.11% of variance explained by first 2 components
#
#
# f1_fig <- fviz_famd_ind(f1, label = "none", habillage = fishbase_f1$class2, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# f1_fig
#
# # ggsave(f1_fig, file = paste0("f1_fig.png"), path = here::here("04_figs"))
```

```{r}
#
# fishbase_f2 <- fishbase_data %>%
#    dplyr::select(r_fin, env_temp, temp_preferred, demers_pelag,
#           body_shape_i, fecundity_mean, longevity_wild, movement_keyword, length, class2,  diet_troph3, food_i) %>%
#    mutate(class2 = as.factor(class2),
#           env_temp = as.factor(env_temp),
#           demers_pelag = as.factor(demers_pelag),
#           body_shape_i = as.factor(body_shape_i)) %>%
#    na.omit()
#
# f2 <- FAMD(fishbase_f2[,1:12], graph=FALSE)
# f2
#
# eigen_f2 <- f2$eig
# eigen_f2 # 42.11% of variance explained by first 2 components
#
#
# f2_fig <- fviz_famd_ind(f2, label = "none", habillage = fishbase_f2$class2, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# f2_fig
#
# fviz_famd_var(f2, geom = "arrow", )


# ggsave(f2_fig, file = paste0("f1_fig.png"), path = here::here("04_figs"))
```


```{r}
# fishbase_f3 <- fishbase_data %>%
#   dplyr::select(length, diet_troph3, demers_pelag, order) %>%
#   mutate(order = as.factor(order), demers_pelag = as.factor(demers_pelag)) %>%
#   na.omit()
#
# f3 <- FAMD(fishbase_f3[,1:3], graph=FALSE)
# f3
#
# eigen_f3 <- f3$eig
# eigen_f3 # 30.38% of variance explained by first 2 components
#
#
# f3_fig <- fviz_famd_ind(f3, label = "none", habillage = fishbase_f3$order, addEllipses = FALSE, ellipse.level = 0.95) +
#   theme_minimal() +
#   theme(legend.position = "none")
# f3_fig


# ggsave(f3_fig, file = paste0("f3_fig.png"), path = here::here("04_figs", "current_pca_famd"))
```


### Initial PCA and FAMD

```{r}
# fishbase_pca1 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select(r_fin,  length, diet_troph3, class) %>%
#   mutate(class = as.factor(class))
#
# # this will only work if all variables are numeric
# #cor.mat <- round(cor(fishbase_pca1),2) # nothing is highly correlated - good!
# #cor.mat
#
# pca1 <- PCA(fishbase_pca1[,1:4], graph = FALSE) # runs the PCA on the first 4 columns (not class)
# pca1
#
# eigen_pca1 <- pca1$eig # large eigenvalue (>1) for a component = it accounts for greater amt of variation than og components
# eigen_pca1 # 66.4% of variance explained by first 2 components
#
# fviz_screeplot(pca1, ncp=10) # scree plot shows eigenvalues/variances associated w components
#
#
# plot(pca1, choix = "var") # this is the same plot as the original PCA code on line 31?
#
#
# pca1_fig <- fviz_pca_ind(pca1, label = "none", habillage = fishbase_pca1$class, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# pca1_fig

# ggsave(pca1_fig, file = paste0("pca1_fig.png"), path = here::here("04_figs"))
```


```{r}
#
# fishbase_pca2 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select(r_fin, length, diet_troph3, class) %>%
#   mutate(class = as.factor(class))
#
# pca2 <- PCA(fishbase_pca2[,1:3], graph = FALSE) # runs the PCA on the first 4 columns (not class)
#
# eigen_pca2 <- pca2$eig # large eigenvalue (>1) for a component = it accounts for greater amt of variation than og components
# eigen_pca2 # 81.45% of variance explained by first 2 components
#
# plot(pca2, choix = "var")
#
#
# pca2_fig <- fviz_pca_ind(pca2, label = "none", habillage = fishbase_pca2$class, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# pca2_fig

# ggsave(pca2_fig, file = paste0("pca2_fig.png"), path = here::here("04_figs"))
```


```{r}
#
# fishbase_pca3 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select( length, diet_troph3, class) %>%
#   mutate(class = as.factor(class))
#
# pca3 <- PCA(fishbase_pca3[,1:3], graph = FALSE) # runs the PCA on the first 4 columns (not class)
#
# eigen_pca3 <- pca3$eig # large eigenvalue (>1) for a component = it accounts for greater amt of variation than og components
# eigen_pca3 # 81.29% of variance explained by first 2 components
#
# plot(pca3, choix = "var")
#
#
# pca3_fig <- fviz_pca_ind(pca3, label = "none", habillage = fishbase_pca3$class, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# pca3_fig
#
# #ggsave(pca3_fig, file = paste0("pca3_fig.png"), path = here::here("04_figs"))
```


```{r}
# fishbase_pca4 <- fishbase_data %>%
#   dplyr::select(where(is.numeric)) %>%
#   dplyr::select(length, diet_troph3, class) %>%
#   mutate(class = as.factor(class))
#
# pca4 <- PCA(fishbase_pca4[,1:2], graph = FALSE) # runs the PCA on the first 4 columns (not class)
#
# eigen_pca4 <- pca4$eig # large eigenvalue (>1) for a component = it accounts for greater amt of variation than og components
# eigen_pca4 # only 2 components
#
# plot(pca4, choix = "var")
#
#
# pca4_fig <- fviz_pca_ind(pca4, label = "none", habillage = fishbase_pca4$class, addEllipses = TRUE,
#                 ellipse.level = 0.95) +
#             theme_minimal()
# pca4_fig # group 6 pretty clearly defined?
#
# #ggsave(pca4_fig, file = paste0("pca4_fig.png"), path = here::here("04_figs"))
```


### FAMD

```{r}
#
# fishbase_famd1 <- fishbase_data %>%
#   dplyr::select(r_fin,  length, diet_troph3, movement_keyword, food_i, class) %>%
#   mutate(class = as.factor(class), movement_keyword = as.factor(movement_keyword), food_i = as.factor(food_i)) %>%
#   na.omit(fishbase_famd1)
#
#
# famd1 <- FAMD(fishbase_famd1[,1:6], graph=FALSE)
# famd1
#
# eigen_famd1 <- famd1$eig
# eigen_famd1 # 7.23% of variance explained by first 2 components!?
#
#
# famd1_fig <- fviz_famd_ind(famd1, label = "none", habillage = fishbase_famd1$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# famd1_fig
# #ggsave(famd1_fig, file = paste0("famd1_fig.png"), path = here::here("04_figs"))
```


```{r}
#
# fishbase_famd2 <- fishbase_data %>%
#   dplyr::select(length, food_i, class) %>%
#   mutate(class = as.factor(class), food_i = as.factor(food_i)) %>%
#   na.omit(fishbase_famd2)
#
# famd2 <- FAMD(fishbase_famd2[,1:2], graph=FALSE)
#
# eigen_famd2 <- famd2$eig
# eigen_famd2 # 5.49%
#
#
# famd2_fig <- fviz_famd_ind(famd2, label = "none", habillage = fishbase_famd2$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# famd2_fig
# #ggsave(famd2_fig, file = paste0("famd2_fig.png"), path = here::here("04_figs"))
```


```{r}
#
# fishbase_famd3 <- fishbase_data %>%
#   dplyr::select(r_fin,  diet_troph3, iucn_category, class) %>%
#   mutate(class = as.factor(class), iucn_category = as.factor(iucn_category)) %>%
#   na.omit(fishbase_famd3)
#
# famd3 <- FAMD(fishbase_famd3[,1:4], graph=FALSE)
# famd3
#
# eigen_famd3 <- famd3$eig
# eigen_famd3 # 31.50% of variance explained by first 2 components
#
#
# famd3_fig <- fviz_famd_ind(famd3, label = "none", habillage = fishbase_famd3$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# famd3_fig
# #ggsave(famd3_fig, file = paste0("famd3_fig.png"), path = here::here("04_figs"))
```


```{r}
#
# fishbase_famd4 <- fishbase_data %>%
#   dplyr::select(length, iucn_category, class) %>%
#   mutate(class = as.factor(class), iucn_category = as.factor(iucn_category)) %>%
#   na.omit(fishbase_famd4)
#
# famd4 <- FAMD(fishbase_famd4[,1:2], graph=FALSE)
# famd4
#
# eigen_famd4 <- famd4$eig
# eigen_famd4 # 38.75% of variance explained by first 2 components
#
#
# famd4_fig <- fviz_famd_ind(famd4, label = "none", habillage = fishbase_famd4$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# famd4_fig
# #ggsave(famd4_fig, file = paste0("famd4_fig.png"), path = here::here("04_figs"))
```


```{r}
# fishbase_famd5 <- fishbase_data %>%
#   dplyr::select(length, demers_pelag, diet_troph3, class) %>%
#   mutate(class = as.factor(class),
#          demers_pelag = as.factor(demers_pelag),
#          diet_troph3 = as.factor(diet_troph3)) %>%
#   na.omit(fishbase_famd5)
#
# famd5 <- FAMD(fishbase_famd5[,1:3], graph=FALSE)
# famd5
#
# eigen_famd5 <- famd5$eig
# eigen_famd5 # 1.27% of variance explained by first 2 components!?
#
#
# famd5_fig <- fviz_famd_ind(famd5, label = "none", habillage = fishbase_famd5$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
# famd5_fig
#
# ggsave(famd5_fig, file = paste0("famd5_fig.png"), path = here::here("04_figs"))
```


```{r}
# fishbase_famd6 <- fishbase_data %>%
#   dplyr::select(length, diet_troph3, demers_pelag, class) %>%
#   mutate(class = as.factor(class), demers_pelag = as.factor(demers_pelag)) %>%
#   na.omit()
#
# famd6 <- FAMD(fishbase_famd6[,1:3], graph=FALSE)
# famd6
#
# eigen_famd6 <- famd6$eig
# eigen_famd6 # 30.38% of variance explained by first 2 components
#
#
# famd6_fig <- fviz_famd_ind(famd6, label = "none", habillage = fishbase_famd6$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
# famd6_fig # still pretty good groupings here
#
# famd6_1_fig <- fviz_famd_ind(famd6, label = "none", habillage = fishbase_famd6$class) +
#   theme_minimal()
# famd6_1_fig # really interesting.. what does it mean?
#
#
# #ggsave(famd6_fig, file = paste0("famd6_fig.png"), path = here::here("04_figs"))
# #ggsave(famd6_1_fig, file = paste0("famd6_1_fig.png"), path = here::here("04_figs"))
```



```{r}
#
# fishbase_famd5 <- fishbase_data %>%
#   dplyr::select(r_fin,  length, diet_troph3, movement_keyword, demers_pelag, food_i, class) %>%
#   mutate(class = as.factor(class),
#          movement_keyword = as.factor(movement_keyword),
#          food_i = as.factor(food_i),
#          demers_pelag = as.factor(demers_pelag)) %>%  # error here?  <--------------------------------------------
#   na.omit(fishbase_famd5)
#
#
# famd5 <- FAMD(fishbase_famd5[,1:7], graph=FALSE)
# famd5
#
# eigen_famd5 <- famd5$eig
# eigen_famd5 # 7.23% of variance explained by first 2 components!?
#
#
# famd5_fig <- fviz_famd_ind(famd5, label = "none", habillage = fishbase_famd5$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
#
# famd5_fig
# #ggsave(famd5_fig, file = paste0("famd5_fig.png"), path = here::here("04_figs"))
#
```


```{r}
#
# fishbase_famd5 <- fishbase_data %>%
#   dplyr::select(r_fin,  length, diet_troph3, food_i, movement_keyword, iucn_category, demers_pelag, class) %>%
#   mutate(class = as.factor(class),
#          demers_pelag = as.factor(demers_pelag),
#          iucn_category = as.factor(iucn_category),
#          food_i = as.factor(food_i),
#          movement_keyword = as.factor(movement_keyword)) %>%
#   na.omit(fishbase_famd5) # error why?  <------------------------------------------------------------------
#
# famd5 <- FAMD(fishbase_famd5[,1:8], graph=FALSE)
# famd5
#
# eigen_famd5 <- famd5$eig
# eigen_famd5 # 30.38% of variance explained by first 2 components
#
#
# famd5_fig <- fviz_famd_ind(famd5, label = "none", habillage = fishbase_famd5$class, addEllipses = TRUE, ellipse.level = 0.95) +
#   theme_minimal()
# famd5_fig
#
#
# #ggsave(famd5_fig, file = paste0("famd5_fig.png"), path = here::here("04_figs"))
#
```


Sort by variable and color by class

```{r}
#
# plot2_data = filled_data %>%
#   filter(r_fin != "NA")
#
# #plot2_data = filled_data
#
# plot2_data <- plot2_data %>%
#   #mutate(r_fin = sort(r_fin)) %>%
#   mutate(species = as.factor(species)) %>%
#   mutate(class2 = as.factor(class2)) %>%
#   mutate(species = fct_relevel(plot2_data$species))
#
# ggplot(plot2_data, aes(species, r_fin)) +
#   geom_point(aes(color = class2)) +
#   theme(axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
#   theme(legend.position = "none")
#
```
