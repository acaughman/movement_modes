---
title: "HR VS PLD"
author: "Allie Caughman"
date: "2/16/2022"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(ggpubr)
library(EnvStats)
library(dbscan)
library(fitdistrplus)
library(mixtools)
library(logspline)
library(plyr)
library(MASS)
library(ggforce)
library(factoextra)
library(NbClust)
library(mclust)
library(tidyverse)
```

### Read in Data

```{r}
data <- read_csv(here::here("01_data", "02_processed_data", "homerange_pld.csv"))
```

### Explore data

```{r}
ggplot(data, aes(log(predicted_homerange), predicted_pld)) +
  geom_point() +
  theme_bw()
```


```{r}
ggplot(data, aes(log(predicted_homerange), predicted_pld)) +
  geom_point() +
  theme_bw() +
  facet_wrap(~movement_keyword) +
  geom_smooth(method = "lm", se = FALSE) +
  stat_cor(label.y = 90)
```

```{r, include = FALSE}
ggplot(data, aes(log(predicted_homerange), predicted_pld)) +
  geom_point() +
  theme_bw() +
  facet_wrap(~demers_pelag) +
  geom_smooth(method = "lm", se = FALSE) +
  stat_cor(label.y = 90)
```

Family with > 5 representatives

```{r, include = FALSE}
fam_sum <- data %>%
  group_by(family) %>%
  summarize(n = n()) %>%
  filter(n > 5)

fam_data <- data %>%
  filter(family %in% fam_sum$family)
```

```{r}
ggplot(fam_data, aes(log(predicted_homerange), predicted_pld)) +
  geom_point() +
  theme_bw() +
  facet_wrap(~family) +
  geom_smooth(method = "lm", se = FALSE) +
  stat_cor(label.y = 75)
```


### Clustering 

```{r, include = FALSE}
pld_data <- data %>%
  dplyr::select(predicted_pld)
hr_data <- data %>%
  dplyr::select(predicted_homerange) %>%
  mutate(predicted_homerange = log(predicted_homerange))

pld_km <- kmeans(pld_data, 3)
hr_km <- kmeans(hr_data, 3)

data$pld_clusters <- pld_km$cluster
data$hr_clusters <- hr_km$cluster

data <- data %>%
  mutate(hr_clusters = as.factor(hr_clusters))
data <- data %>%
  mutate(pld_clusters = as.factor(pld_clusters))

ggplot(data, aes(x = log(predicted_homerange), y = predicted_pld)) +
  geom_jitter(aes(color = hr_clusters)) +
  theme_bw()
ggplot(data, aes(x = log(predicted_homerange), y = predicted_pld)) +
  geom_jitter(aes(color = pld_clusters)) +
  theme_bw()
```

Gaussian Mixture Model

```{r}
gmm_data_log <- data %>%
  dplyr::select(predicted_homerange, predicted_pld) %>%
  mutate(predicted_homerange = log(predicted_homerange))

gmm_mclust <- Mclust(gmm_data_log)

summary(gmm_mclust)

plot(gmm_mclust, what = "classification")
```

```{r}
gmm_data <- data %>%
  dplyr::select(predicted_homerange, predicted_pld) %>%
  mutate(log_predicted_homerange = log(predicted_homerange)) %>%
  filter(log_predicted_homerange < 5) %>%
  select(-log_predicted_homerange)

gmm_mclust <- Mclust(gmm_data)

summary(gmm_mclust)

plot(gmm_mclust, what = "classification", xlim = c(0, 1))
```



```{r, include = FALSE}
hr <- data %>%
  pull(predicted_homerange)

pld <- data %>%
  pull(predicted_pld)

MASS::boxcox(pld ~ hr)

bc_hr <- 1 / sqrt(hr)
```

```{r, include = FALSE}
descdist(bc_hr, discrete = FALSE)
descdist(pld, discrete = FALSE)

fit.pld.lognorm <- fitdist(pld, "lnorm")
fit.pld.weibull <- fitdist(pld, "weibull")
fit.pld.gamma <- fitdist(pld, "gamma")

c(fit.pld.lognorm$loglik, fit.pld.weibull$loglik, fit.pld.gamma$loglik)

plot(fit.pld.lognorm)
```

```{r, include = FALSE}
fit.hr <- spEMsymloc(bc_hr, mu0 = c(3, 28))
fit.hr.norm <- normalmixEM(bc_hr)

fit.hr.norm$loglik

plot(fit.hr)
lines(density(bc_hr), lty = 2, lwd = 2)

plot(fit.hr.norm, which = 2)
lines(density(bc_hr), lty = 2, lwd = 2)
```
