---
title: "Characterising Fish Movement Modes Project Overivew"
output: pdf_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(mclust)
```

# Overview

This project is interested in exploring the relationship between two different movement modes for marine species: larval dispersal and adult movement, which has been data limited in the past. To do this, I have a database of 607 species with information for both modes generated from a random forest regression model. The goal of the project is to create groupings of species with similar characteristic and model the relationship between pelagic larval duration and adult home ranges. This information will then be used to inform future work on species ability to track climate change as well as determine conservation strategies for different combinations of movement traits.

### Outline of Tasks

1. Read/Skim Baseline Papers

* Lester, S. E., Ruttenberg, B. I., Gaines, S. D., & Kinlan, B. P. (2007). The relationship between dispersal ability and geographic range size. Ecology Letters, 10(8), 745–758. https://doi.org/10.1111/j.1461-0248.2007.01070.x <- (Please read this paper in its entirety)
* Green, A. L., Maypa, A. P., Almany, G. R., Rhodes, K. L., Weeks, R., Abesamis, R. A., Gleason, M. G., Mumby, P. J., & White, A. T. (2015). Larval dispersal and movement patterns of coral reef fishes, and implications for marine reserve network design. Biological Reviews, 90(4), 1215–1247. https://doi.org/10.1111/brv.12155 <- marine reserve guidelines based on movement ecology overview; consideres adult movement and larval dipseral seperately (skim is fine)
* Grüss, A., Kaplan, D. M., & Hart, D. R. (2011). Relative Impacts of Adult Movement, Larval Dispersal and Harvester Movement on the Effectiveness of Reserve Networks. PLoS ONE, 6(5), e19960. https://doi.org/10.1371/journal.pone.0019960 and Moffitt, E. A., White, J. W., & Botsford, L. W. (2011). The utility and limitations of size and spacing guidelines for designing marine protected area (MPA) networks. Biological Conservation. https://doi.org/10.1016/j.biocon.2010.09.008 <- marine reserve guidelines considering both adult movement and larval dispersal together (skim Grüss, I'd read Moffitt more thoroughly)
* O’Connor, M. I., Bruno, J. F., Gaines, S. D., Halpern, B. S., Lester, S. E., Kinlan, B. P., & Weiss, J. M. (2007). Temperature control of larval dispersal and the implications for marine ecology, evolution, and conservation. Proceedings of the National Academy of Sciences, 104(4), 1266–1271. https://doi.org/10.1073/pnas.0603422104 <- (skim; math heavy don't worry about the weeds)

2. Create Groupings of Species (See below for Start; see Lester et al. (2007) and Fish base Tables for variable ideas)

3. Model relationship
* Start with "reproducing" Lester et al. (2007); don't aim for perfect reproduction, use as more guidelines. I also don't expect to largely use linear regression
* Using this we can determine next steps for modeling

### Deliverables

1. All code developed, with comments (save code you end up not using at bottom of scripts)
2. Detailed Methods of all things you did (even ones that didn't work well)
3. Polished methods draft of work

### Data Overview

```{r}
data <- read_csv(here::here("01_data", "02_processed_data", "homerange_pld.csv")) %>%
  mutate(home_range = case_when(
    !is.na(observed_homerange) ~ observed_homerange,
    is.na(observed_homerange) ~ predicted_homerange
  )) %>%
  mutate(pld = case_when(
    !is.na(observed_pld) ~ observed_pld,
    is.na(observed_pld) ~ predicted_pld
  )) %>%
  filter(pld < 400) %>%
  mutate(magnitude_homerange = floor(log10(home_range))) %>%
  mutate(month_pld = ceiling(pld / 30))
```

This data was generated by a random forest regression model (https://towardsdatascience.com/random-forest-regression-5f605132d19d), meaning it is not empirical, but is predicted data. The next plot shows the actual values of the predictions.

```{r}
p1 <- ggplot(data, aes(log(home_range), pld)) +
  geom_point() +
  theme_bw() +
  labs(
    x = "log(Predicted Home Range)",
    y = "Predicted Pelagic Larval Duration"
  )

p1

ggsave(p1, file = paste0("data_fig.pdf"), path = here::here("04_figs"), height = 8, width = 15)
```

However, the models were validated based on accuracy at the order of magnitude level for home range and month for PLD. They were also relatively conservative underestimates. Therefore, I think we'll start by trying to cluster these values.

```{r}
ggplot(data, aes(magnitude_homerange, month_pld)) +
  geom_jitter() +
  theme_bw() +
  labs(
    x = "Predicted Home Range Magnitude",
    y = "Predicted Pelagic Larval Duration Month"
  )
```

##### Intial Clustering

Here, I using a Gaussian Mixture Model (https://towardsdatascience.com/gaussian-mixture-models-d13a5e915c8e). 

```{r}
gmm_data <- data %>%
  dplyr::select(magnitude_homerange, month_pld)

gmm_mclust2 <- Mclust(gmm_data)

summary(gmm_mclust2)

gmm_data$class <- as.factor(gmm_mclust2[["classification"]])

p2 <- ggplot(gmm_data, aes(magnitude_homerange, month_pld)) +
  geom_jitter(aes(color = class)) +
  theme_bw() +
  labs(
    x = "Order of Magnitude of Predicted Home Range",
    y = "Predicted Pelagic Larval Duration (Month)"
  )

p2

ggsave(p2, file = paste0("gmm_fig.pdf"), path = here::here("04_figs"), height = 8, width = 15)
```

My idea is for you to start with these clusters. You can get the cluster ID for each individual species from `gmm_data` and then start pulling in variables to describe and, ideally, differentiate these clusters. Some of them are small so feel free to try combining some.

# Week 1

### Tasks:

Meeting 1:

1. Set up Github in R 
2. I'll show you the random forest model for how this data was generated
3. We'll walk through Lester et al. and Fishbase together briefly

Prior to Meeting 2:

1. Read/Skim Papers and Prepare any questions you have, anything you need help understanding
2. Try to familiarize yourself some with what is in the FishBase tables

Meeting 2:

1. Discuss Papers
2. Strategize for characterization work
3. Discuss Week 2 goals
4. Show github organization

This will get less structured as we go. If you need more to do or get stuck at any point, I'm pretty free for last minute meetings, working sessions, etc. My calendar is always up to date.
